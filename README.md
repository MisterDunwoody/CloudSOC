# Azure-SOC + Honeynet (Live Cyber Attacks)




## Azure Honeynet Project: Log Analysis and Security Improvement
In this project, a mini honeynet was constructed within the Azure platform to capture and analyze logs from multiple sources, consolidated in a Log Analytics workspace. Microsoft Sentinel was deployed to utilize these logs for creating attack maps, alert triggers, and generating incidents.

The project was conducted in several phases:

Security Control Implementation: Various security measures were applied to fortify the environment.
Post-Implementation Monitoring : Metrics were measured the impact of the implemented controls over time.

Metrics Analyzed:

SecurityEvent: Windows Event Logs
Syslog: Linux Event Logs
SecurityAlert: Alerts triggered in Log Analytics
SecurityIncident: Incidents generated by Sentinel
AzureNetworkAnalytics_CL: Malicious flows allowed into the honeynet

The results demonstrate how proactive monitoring and layered security controls significantly reduced malicious activity and improved the overall security posture of the environment. Explore the repository for detailed metrics, visualizations, and insights from each phase.

## Technologies, Azure Components, and Regulations Employed
- Azure Virtual Network (VNet)
- Azure Network Security Groups (NSG)
- Virtual Machines (2 Windows VMs, 1 Linux VM)
- Log Analytics Workspace with Kusto Query Language (KQL) Queries
- Azure Key Vault for Secure Secrets Management
- Azure Storage Account for Data Storage
- Microsoft Sentinel for Security Information and Event Management (SIEM)
- Microsoft Defender for Cloud to Protect Cloud Resources
- Windows Remote Desktop for Remote Access
- Command Line Interface (CLI) for System Management
- PowerShell for Automation and Configuration Management
- [NIST SP 800-53 Revision 5](https://csrc.nist.gov/publications/detail/sp/800-53/rev-5/final) for Security Controls
- [NIST SP 800-61 Revision 2](https://www.nist.gov/privacy-framework/nist-sp-800-61) for Incident Handling Guidance

##  Before addding Hardening or Security Controls

In the initial stage of this project, a virtual environment was deliberately exposed to the public internet to attract threat actors and analyze their attack patterns. A Windows virtual machine hosting a SQL database and a Linux server were deployed with their Network Security Groups (NSGs) configured to "Allow All." To further entice attackers, a storage account and key vault with public endpoints were also deployed. Microsoft Sentinel was used to monitor the unsecured environment by analyzing logs aggregated in the Log Analytics workspace.

## Attack Maps Before adding Hardening or Security Controls

<b>This attack map shows the traffic allowed by a Network Security Group with all traffic allowed inbound</b>

![image](https://github.com/user-attachments/assets/ef5ef2bf-fa93-4ed6-b424-8adc4ddaa7fc)

<b>This attack map shows all the attempts threat actors trying to access the Linux virtual machine via SSH</b>

![image](https://github.com/user-attachments/assets/7d4f523e-ac8e-4186-9cfd-5b4de6afe68e)

<b>This attack map shows all the attempts threat actors trying to access the Windows virtual machine via RDP</b>

![image](https://github.com/user-attachments/assets/120aa1a8-bd2a-4447-b072-3e8a05d3f7e2)

<b> There were no query results to create an attack map to shows all the attempts threat actors trying to access the Microsoft SQL Database Server within the Windows virtual machine</b>

## Stats Before adding Hardening or  Security Controls

The following table shows the metrics we measured in our insecure environment for 24 hours:
Start Time 2024-12-22 T08:39:00
Stop Time 2024-12-23 T08:50:00

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 91322
| Syslog                   | 9257
| SecurityAlert            | 0
| SecurityIncident         | 499
| AzureNetworkAnalytics_CL | 1400

## Stats After 24HRs of Hardening or Security Controls

Hardening the Environment: Back half Stage
In the back half of this project, the environment was secured by implementing robust security controls in compliance with NIST SP 800-53 Rev4 SC-7(3) Access Points. These measures were designed to mitigate risks and protect critical resources from unauthorized access.

Security Enhancements Implemented
Network Security Groups (NSGs):
NSGs were configured to block all inbound and outbound traffic except for designated public IP addresses requiring access to the virtual machines. This ensured that only trusted sources could communicate with the VMs, significantly reducing the risk of unauthorized access.

Built-in Firewalls:
Azure's built-in firewalls were fine-tuned to restrict unauthorized connections and safeguard resources from malicious traffic. Firewall rules were customized for each virtual machine based on its role, minimizing the attack surface available to threat actors.

Private Endpoints:
Public endpoints for Azure Key Vault and Storage Containers were replaced with private endpoints, ensuring these sensitive resources were accessible only within the virtual network. This step eliminated exposure to the public internet.

Subnetting:
A dedicated subnet was created for Azure Key Vault and Storage Containers, isolating their traffic and adding an extra layer of security. This segmentation helped reduce the risk of lateral movement in the network.

These hardening strategies significantly enhanced the environmentâ€™s security posture, limiting vulnerabilities and aligning with industry best practices for access control.

## Attack Results After 24HRs after adding Hardening or Security Controls

> All map queries actually returned no results due to no instances of malicious activity for the 24 hour period after hardening.


## Metrics Before and After 24 HRs of added Hardening or Security Controls

| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 91322
| Syslog                   | 9257
| SecurityAlert            | 0
| SecurityIncident         | 499
| AzureNetworkAnalytics_CL | 1400


| Metric                   | Count
| ------------------------ | -----
| SecurityEvent            | 50724
| Syslog                   | 2
| SecurityAlert            | 0
| SecurityIncident         | 0
| AzureNetworkAnalytics_CL | 0

## Reflection

This project gave me a deeper appreciation for the importance of security and was incredibly enjoyable to create. It underscored the critical need for proper security controls and configurations to protect resources. The before-and-after metrics demonstrated the significant difference between an insecure and secure environment, while the map data or lack there of highlighted the impact of these changes. Implementing firewall rules, private endpoints, and restricting public internet access is essential to prevent attacks from threat actors and unauthorized access to critical assets.

## Conclusion

In this project, a compact yet effective honeynet was built in Microsoft Azure, with log sources integrated into a Log Analytics workspace. Microsoft Sentinel was configured to generate alerts and incidents based on the collected logs. Metrics were analyzed both before and after applying security controls to measure the impact of the implemented security measures.



### The following table shows the percentage metrics we measured in our environment for another 24 hours, after applied security controls:

| Metric                                       | Change post-hardening
| -------------------------------------------- | -----
| SecurityEvent (Windows VMs)                  | -99.26%
| Syslog (Linux VMs)                           | -100.00%
| SecurityAlert (Microsoft Defender for Cloud) | 0.00%
| SecurityIncident (Sentinel Incidents)        | -100.00%%
| AzureNetworkAnalytics_CL                     | -100.00%%
